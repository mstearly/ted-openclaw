{
  "_config_version": 1,
  "_artifact": "feature_registry_schema",
  "_description": "JSON Schema contract for feature_registry.json used by council governance startup gates.",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Ted Feature Registry",
  "type": "object",
  "required": ["_config_version", "_artifact", "policy_context", "features"],
  "properties": {
    "_config_version": { "type": "integer", "minimum": 1 },
    "_artifact": { "type": "string", "const": "feature_registry" },
    "_description": { "type": "string" },
    "_generated_by": { "type": "string" },
    "_generated_at": { "type": "string" },
    "policy_context": { "$ref": "#/$defs/policyContext" },
    "features": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/featureEntry" }
    }
  },
  "$defs": {
    "policyContext": {
      "type": "object",
      "required": ["policy_precedence", "release_gate_kpis", "module_classes"],
      "properties": {
        "policy_precedence": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "minItems": 1
        },
        "release_gate_kpis": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "minItems": 1
        },
        "module_classes": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["policy", "workflow", "connector", "domain_engine"]
          },
          "minItems": 4
        }
      }
    },
    "stringList": {
      "type": "array",
      "items": { "type": "string", "minLength": 1 }
    },
    "featureEntry": {
      "type": "object",
      "required": [
        "feature_id",
        "name",
        "plane",
        "owner",
        "backup_owner",
        "module_class",
        "lifecycle_state",
        "maturity_score",
        "fragility_score",
        "qa_contracts",
        "security_controls",
        "runtime_signals",
        "usage_signals",
        "dependencies",
        "research_profile"
      ],
      "properties": {
        "feature_id": { "type": "string", "minLength": 1 },
        "name": { "type": "string", "minLength": 1 },
        "plane": {
          "type": "string",
          "enum": ["control", "connector", "state", "contract", "experience"]
        },
        "owner": { "type": "string", "minLength": 1 },
        "backup_owner": { "type": "string", "minLength": 1 },
        "module_class": {
          "type": "string",
          "enum": ["policy", "workflow", "connector", "domain_engine"]
        },
        "lifecycle_state": {
          "type": "string",
          "enum": ["proposed", "incubating", "graduated", "mature", "retiring"]
        },
        "maturity_score": { "type": "integer", "minimum": 0, "maximum": 5 },
        "fragility_score": { "type": "number", "minimum": 0, "maximum": 100 },
        "qa_contracts": {
          "type": "object",
          "required": ["test_suites", "replay_scenarios", "browser_gates"],
          "properties": {
            "test_suites": { "$ref": "#/$defs/stringList" },
            "replay_scenarios": { "$ref": "#/$defs/stringList" },
            "browser_gates": { "$ref": "#/$defs/stringList" }
          }
        },
        "security_controls": {
          "type": "object",
          "required": ["policy_refs", "owasp_llm_top10"],
          "properties": {
            "policy_refs": { "$ref": "#/$defs/stringList" },
            "owasp_llm_top10": { "$ref": "#/$defs/stringList" }
          }
        },
        "runtime_signals": {
          "type": "object",
          "required": ["events", "slos", "alerts"],
          "properties": {
            "events": { "$ref": "#/$defs/stringList" },
            "slos": { "$ref": "#/$defs/stringList" },
            "alerts": { "$ref": "#/$defs/stringList" }
          }
        },
        "usage_signals": {
          "type": "object",
          "required": ["invocation_count_30d", "adoption_ratio_30d", "success_rate_30d"],
          "properties": {
            "invocation_count_30d": { "type": ["number", "null"], "minimum": 0 },
            "adoption_ratio_30d": { "type": ["number", "null"], "minimum": 0, "maximum": 1 },
            "success_rate_30d": { "type": ["number", "null"], "minimum": 0, "maximum": 1 }
          }
        },
        "dependencies": { "$ref": "#/$defs/stringList" },
        "research_profile": {
          "type": "object",
          "required": ["last_benchmark_date", "trigger_conditions", "external_patterns"],
          "properties": {
            "last_benchmark_date": { "type": ["string", "null"] },
            "trigger_conditions": { "$ref": "#/$defs/stringList" },
            "external_patterns": { "$ref": "#/$defs/stringList" }
          }
        },
        "source_refs": {
          "type": "object",
          "properties": {
            "feature_maturity_level": { "type": ["string", "null"] },
            "capability_level": { "type": ["integer", "null"] },
            "capability_target": { "type": ["integer", "null"] },
            "research_debt_score": { "type": ["string", "null"] }
          }
        }
      }
    }
  }
}
